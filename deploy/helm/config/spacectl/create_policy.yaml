---
var:
  policy:
  - policy_id: policy-managed-domain-admin
    name: Domain Admin Access
    permissions:
      - identity.Domain.update
      - identity.Domain.change_auth_plugin
      - identity.Domain.update_plugin
      - identity.Domain.verify_plugin
      - identity.Domain.get
      - identity.Domain.list
      - identity.Endpoint.list
      - identity.Provider.*
      - identity.ServiceAccount.*
      - identity.ProjectGroup.*
      - identity.Project.*
      - identity.Policy.*
      - identity.Role.*
      - identity.RoleBinding.*
      - identity.User.*
      - identity.APIKey.*
      - secret.Secret.create
      - secret.Secret.update
      - secret.Secret.delete
      - secret.Secret.update_data
      - secret.Secret.get
      - secret.Secret.list
      - secret.Secret.stat
      - secret.TrustedSecret.create
      - secret.TrustedSecret.update
      - secret.TrustedSecret.delete
      - secret.TrustedSecret.update_data
      - secret.TrustedSecret.get
      - secret.TrustedSecret.list
      - secret.TrustedSecret.stat
      - secret.SecretGroup.*
      - repository.Repository.*
      - repository.Plugin.*
      - repository.Schema.*
      - repository.Policy.*
      - inventory.Region.*
      - inventory.Server.*
      - inventory.CloudServiceType.*
      - inventory.CloudService.*
      - inventory.ResourceGroup.*
      - inventory.Collector.*
      - inventory.CollectorRule.*
      - inventory.Job.*
      - inventory.JobTask.*
      - inventory.ChangeHistory.*
      - inventory.Note.*
      - monitoring.DataSource.*
      - monitoring.Metric.*
      - monitoring.Log.*
      - monitoring.ProjectAlertConfig.*
      - monitoring.EscalationPolicy.*
      - monitoring.EventRule.*
      - monitoring.Webhook.*
      - monitoring.MaintenanceWindow.*
      - monitoring.Alert.create
      - monitoring.Alert.update
      - monitoring.Alert.merge
      - monitoring.Alert.snooze
      - monitoring.Alert.add_responder
      - monitoring.Alert.remove_responder
      - monitoring.Alert.add_project_dependency
      - monitoring.Alert.remove_project_dependency
      - monitoring.Alert.delete
      - monitoring.Alert.get
      - monitoring.Alert.list
      - monitoring.Alert.stat
      - monitoring.Event.*
      - monitoring.Note.*
      - monitoring.AlertLog.*
      - monitoring.Job.*
      - plugin.Supervisor.*
      - statistics.Resource.*
      - statistics.Storage.*
      - statistics.Schedule.*
      - statistics.History.list
      - statistics.History.stat
      - billing.DataSource.*
      - billing.Billing.*
      - config.UserConfig.*
      - config.DomainConfig.*
      - notification.Protocol.*
      - notification.ProjectChannel.*
      - notification.UserChannel.*
      - notification.Notification.*
      - notification.Quota.*
      - notification.NotificationUsage.*
      - cost_analysis.PublicDashboard.*
      - cost_analysis.UserDashboard.*
      - cost_analysis.CustomWidget.*
      - cost_analysis.DataSource.*
      - cost_analysis.Schedule.*
      - cost_analysis.ExchangeRate.*
      - cost_analysis.Cost.*
      - cost_analysis.DataSourceRule.*
      - cost_analysis.Budget.*
      - cost_analysis.BudgetUsage.*
      - cost_analysis.Dashboard.*
      - cost_analysis.CostQuerySet.*
      - cost_analysis.Job.*
      - cost_analysis.JobTask.*
      - board.Board.get
      - board.Board.list
      - board.Board.stat
      - board.Post.*
      - file_manager.File.*
      - dashboard.DomainDashboard.*
      - dashboard.ProjectDashboard.*
      - dashboard.CustomWidget.*
  - policy_id: policy-managed-domain-viewer
    name: Domain Viewer Access
    permissions:
      - identity.Domain.get
      - identity.Domain.stat
      - identity.Endpoint.list
      - identity.Provider.get
      - identity.Provider.list
      - identity.Provider.stat
      - identity.ServiceAccount.get
      - identity.ServiceAccount.list
      - identity.ServiceAccount.stat
      - identity.ProjectGroup.get
      - identity.ProjectGroup.list_members
      - identity.ProjectGroup.list_projects
      - identity.ProjectGroup.list
      - identity.ProjectGroup.stat
      - identity.Project.get
      - identity.Project.list_members
      - identity.Project.list
      - identity.Project.stat
      - identity.Policy.get
      - identity.Policy.list
      - identity.Policy.stat
      - identity.Role.get
      - identity.Role.list
      - identity.Role.stat
      - identity.RoleBinding.get
      - identity.RoleBinding.list
      - identity.RoleBinding.stat
      - identity.User.update
      - identity.User.verify_email
      - identity.User.confirm_email
      - identity.User.find
      - identity.User.get
      - identity.User.list
      - identity.User.stat
      - identity.APIKey.*
      - secret.Secret.get
      - secret.Secret.list
      - secret.Secret.stat
      - secret.TrustedSecret.get
      - secret.TrustedSecret.list
      - secret.TrustedSecret.stat
      - secret.SecretGroup.get
      - secret.SecretGroup.list
      - secret.SecretGroup.stat
      - repository.Repository.get
      - repository.Repository.list
      - repository.Repository.stat
      - repository.Plugin.get_versions
      - repository.Plugin.get
      - repository.Plugin.list
      - repository.Plugin.stat
      - repository.Schema.get
      - repository.Schema.list
      - repository.Schema.stat
      - repository.Policy.get
      - repository.Policy.list
      - repository.Policy.stat
      - inventory.Region.get
      - inventory.Region.list
      - inventory.Region.stat
      - inventory.Server.get
      - inventory.Server.list
      - inventory.Server.stat
      - inventory.CloudServiceType.get
      - inventory.CloudServiceType.list
      - inventory.CloudServiceType.stat
      - inventory.CloudService.get
      - inventory.CloudService.list
      - inventory.CloudService.stat
      - inventory.CloudService.analyze
      - inventory.ResourceGroup.get
      - inventory.ResourceGroup.list
      - inventory.ResourceGroup.stat
      - inventory.Collector.get
      - inventory.Collector.list_schedules
      - inventory.Collector.get_schedule
      - inventory.Collector.list
      - inventory.Collector.stat
      - inventory.CollectorRule.get
      - inventory.CollectorRule.list
      - inventory.CollectorRule.stat
      - inventory.Job.list
      - inventory.Job.stat
      - inventory.JobTask.list
      - inventory.JobTask.stat
      - inventory.ChangeHistory.list
      - inventory.ChangeHistory.stat
      - inventory.Note.get
      - inventory.Note.list
      - inventory.Note.stat
      - monitoring.DataSource.get
      - monitoring.DataSource.list
      - monitoring.DataSource.stat
      - monitoring.Metric.*
      - monitoring.Log.*
      - monitoring.ProjectAlertConfig.get
      - monitoring.ProjectAlertConfig.list
      - monitoring.ProjectAlertConfig.stat
      - monitoring.EscalationPolicy.get
      - monitoring.EscalationPolicy.list
      - monitoring.EscalationPolicy.stat
      - monitoring.EventRule.get
      - monitoring.EventRule.list
      - monitoring.EventRule.stat
      - monitoring.Webhook.get
      - monitoring.Webhook.list
      - monitoring.Webhook.stat
      - monitoring.MaintenanceWindow.get
      - monitoring.MaintenanceWindow.list
      - monitoring.MaintenanceWindow.stat
      - monitoring.Alert.get
      - monitoring.Alert.list
      - monitoring.Alert.stat
      - monitoring.Event.get
      - monitoring.Event.list
      - monitoring.Event.stat
      - monitoring.Note.get
      - monitoring.Note.list
      - monitoring.Note.stat
      - monitoring.AlertLog.get
      - monitoring.AlertLog.list
      - monitoring.AlertLog.stat
      - monitoring.Job.get
      - monitoring.Job.list
      - monitoring.Job.stat
      - plugin.Supervisor.list_plugins
      - plugin.Supervisor.get
      - plugin.Supervisor.list
      - plugin.Supervisor.stat
      - statistics.Resource.stat
      - statistics.Storage.get
      - statistics.Storage.list
      - statistics.Storage.stat
      - statistics.Schedule.get
      - statistics.Schedule.list
      - statistics.Schedule.stat
      - statistics.History.list
      - statistics.History.stat
      - billing.DataSource.get
      - billing.DataSource.list
      - billing.DataSource.stat
      - billing.Billing.get_data
      - config.UserConfig.*
      - config.DomainConfig.get
      - config.DomainConfig.list
      - config.DomainConfig.stat
      - notification.Protocol.get
      - notification.Protocol.list
      - notification.Protocol.stat
      - notification.ProjectChannel.get
      - notification.ProjectChannel.list
      - notification.ProjectChannel.stat
      - notification.UserChannel.*
      - notification.Notification.delete
      - notification.Notification.set_read
      - notification.Notification.get
      - notification.Notification.list
      - notification.Notification.stat
      - notification.Quota.get
      - notification.Quota.list
      - notification.Quota.stat
      - notification.NotificationUsage.*
      - cost_analysis.DataSource.get
      - cost_analysis.DataSource.list
      - cost_analysis.DataSource.stat
      - cost_analysis.Schedule.get
      - cost_analysis.Schedule.list
      - cost_analysis.Schedule.stat
      - cost_analysis.ExchangeRate.get
      - cost_analysis.ExchangeRate.list
      - cost_analysis.Cost.get
      - cost_analysis.Cost.list
      - cost_analysis.Cost.analyze
      - cost_analysis.Cost.analyze_v2
      - cost_analysis.Cost.stat
      - cost_analysis.DataSourceRule.get
      - cost_analysis.DataSourceRule.list
      - cost_analysis.DataSourceRule.stat
      - cost_analysis.Budget.get
      - cost_analysis.Budget.list
      - cost_analysis.Budget.stat
      - cost_analysis.BudgetUsage.list
      - cost_analysis.BudgetUsage.stat
      - cost_analysis.BudgetUsage.analyze
      - cost_analysis.Dashboard.get
      - cost_analysis.Dashboard.list
      - cost_analysis.CostQuerySet.*
      - cost_analysis.Job.get
      - cost_analysis.Job.list
      - cost_analysis.Job.stat
      - cost_analysis.JobTask.get
      - cost_analysis.JobTask.list
      - cost_analysis.JobTask.stat
      - cost_analysis.PublicDashboard.get
      - cost_analysis.PublicDashboard.list
      - cost_analysis.PublicDashboard.stat
      - cost_analysis.UserDashboard.*
      - cost_analysis.CustomWidget.*
      - board.Board.get
      - board.Board.list
      - board.Board.stat
      - board.Post.get
      - board.Post.list
      - board.Post.stat
      - file_manager.File.get_download_url
      - file_manager.File.get
      - file_manager.File.list
      - file_manager.File.stat
      - dashboard.DomainDashboard.*
      - dashboard.ProjectDashboard.*
      - dashboard.CustomWidget.*
  - policy_id: policy-managed-project-manager
    name: Project Manager Access
    permissions:
      - identity.Domain.get
      - identity.Domain.list
      - identity.Endpoint.list
      - identity.Provider.get
      - identity.Provider.list
      - identity.Provider.stat
      - identity.ServiceAccount.*
      - identity.ProjectGroup.*
      - identity.Project.*
      - identity.Policy.get
      - identity.Policy.list
      - identity.Policy.stat
      - identity.Role.get
      - identity.Role.list
      - identity.Role.stat
      - identity.RoleBinding.get
      - identity.RoleBinding.list
      - identity.RoleBinding.stat
      - identity.User.update
      - identity.User.verify_email
      - identity.User.confirm_email
      - identity.User.find
      - identity.User.sync
      - identity.User.get
      - identity.User.list
      - identity.User.stat
      - identity.APIKey.*
      - secret.Secret.create
      - secret.Secret.update
      - secret.Secret.delete
      - secret.Secret.update_data
      - secret.Secret.get
      - secret.Secret.list
      - secret.Secret.stat
      - secret.TrustedSecret.get
      - secret.TrustedSecret.list
      - secret.TrustedSecret.stat
      - secret.SecretGroup.*
      - repository.Repository.get
      - repository.Repository.list
      - repository.Repository.stat
      - repository.Plugin.get_versions
      - repository.Plugin.get
      - repository.Plugin.list
      - repository.Plugin.stat
      - repository.Schema.get
      - repository.Schema.list
      - repository.Schema.stat
      - repository.Policy.get
      - repository.Policy.list
      - repository.Policy.stat
      - inventory.Region.*
      - inventory.Server.*
      - inventory.CloudServiceType.*
      - inventory.CloudService.*
      - inventory.ResourceGroup.*
      - inventory.Collector.get
      - inventory.Collector.list_schedules
      - inventory.Collector.get_schedule
      - inventory.Collector.list
      - inventory.Collector.stat
      - inventory.CollectorRule.get
      - inventory.CollectorRule.list
      - inventory.CollectorRule.stat
      - inventory.Job.*
      - inventory.JobTask.*
      - inventory.ChangeHistory.*
      - inventory.Note.*
      - monitoring.DataSource.get
      - monitoring.DataSource.list
      - monitoring.DataSource.stat
      - monitoring.Metric.*
      - monitoring.Log.*
      - monitoring.ProjectAlertConfig.*
      - monitoring.EscalationPolicy.*
      - monitoring.EventRule.*
      - monitoring.Webhook.*
      - monitoring.MaintenanceWindow.*
      - monitoring.Alert.*
      - monitoring.Event.get
      - monitoring.Event.list
      - monitoring.Event.stat
      - monitoring.Note.*
      - monitoring.AlertLog.*
      - monitoring.Job.*
      - statistics.Resource.*
      - statistics.Storage.*
      - statistics.Schedule.*
      - statistics.History.*
      - billing.Billing.get_data
      - config.UserConfig.*
      - config.DomainConfig.get
      - config.DomainConfig.list
      - config.DomainConfig.stat
      - notification.Protocol.get
      - notification.Protocol.list
      - notification.Protocol.stat
      - notification.ProjectChannel.*
      - notification.UserChannel.*
      - notification.Notification.*
      - cost_analysis.DataSource.get
      - cost_analysis.DataSource.list
      - cost_analysis.DataSource.stat
      - cost_analysis.Schedule.get
      - cost_analysis.Schedule.list
      - cost_analysis.Schedule.stat
      - cost_analysis.ExchangeRate.get
      - cost_analysis.ExchangeRate.list
      - cost_analysis.Cost.get
      - cost_analysis.Cost.list
      - cost_analysis.Cost.analyze
      - cost_analysis.Cost.analyze_v2
      - cost_analysis.Cost.stat
      - cost_analysis.DataSourceRule.get
      - cost_analysis.DataSourceRule.list
      - cost_analysis.DataSourceRule.stat
      - cost_analysis.Budget.*
      - cost_analysis.BudgetUsage.*
      - cost_analysis.Dashboard.get
      - cost_analysis.Dashboard.list
      - cost_analysis.CostQuerySet.*
      - cost_analysis.Job.get
      - cost_analysis.Job.list
      - cost_analysis.Job.stat
      - cost_analysis.JobTask.get
      - cost_analysis.JobTask.list
      - cost_analysis.JobTask.stat
      - cost_analysis.PublicDashboard.get
      - cost_analysis.PublicDashboard.list
      - cost_analysis.PublicDashboard.stat
      - cost_analysis.UserDashboard.*
      - cost_analysis.CustomWidget.*
      - board.Board.get
      - board.Board.list
      - board.Board.stat
      - board.Post.get
      - board.Post.list
      - board.Post.stat
      - file_manager.File.*
      - dashboard.DomainDashboard.*
      - dashboard.ProjectDashboard.*
      - dashboard.CustomWidget.*
  - policy_id: policy-managed-project-viewer
    name: Project Viewer Access
    permissions:
      - identity.Domain.get
      - identity.Domain.list
      - identity.Endpoint.list
      - identity.Provider.get
      - identity.Provider.list
      - identity.Provider.stat
      - identity.ServiceAccount.get
      - identity.ServiceAccount.list
      - identity.ServiceAccount.stat
      - identity.ProjectGroup.get
      - identity.ProjectGroup.list_members
      - identity.ProjectGroup.list_projects
      - identity.ProjectGroup.list
      - identity.ProjectGroup.stat
      - identity.Project.get
      - identity.Project.list_members
      - identity.Project.list
      - identity.Project.stat
      - identity.Policy.get
      - identity.Policy.list
      - identity.Policy.stat
      - identity.Role.get
      - identity.Role.list
      - identity.Role.stat
      - identity.RoleBinding.get
      - identity.RoleBinding.list
      - identity.RoleBinding.stat
      - identity.User.update
      - identity.User.find
      - identity.User.get
      - identity.User.list
      - identity.User.stat
      - identity.APIKey.*
      - secret.Secret.get
      - secret.Secret.list
      - secret.Secret.stat
      - secret.TrustedSecret.get
      - secret.TrustedSecret.list
      - secret.TrustedSecret.stat
      - secret.SecretGroup.get
      - secret.SecretGroup.list
      - secret.SecretGroup.stat
      - repository.Repository.get
      - repository.Repository.list
      - repository.Repository.stat
      - repository.Plugin.get_versions
      - repository.Plugin.get
      - repository.Plugin.list
      - repository.Plugin.stat
      - repository.Schema.get
      - repository.Schema.list
      - repository.Schema.stat
      - repository.Policy.get
      - repository.Policy.list
      - repository.Policy.stat
      - inventory.Region.get
      - inventory.Region.list
      - inventory.Region.stat
      - inventory.Server.get
      - inventory.Server.list
      - inventory.Server.stat
      - inventory.CloudServiceType.get
      - inventory.CloudServiceType.list
      - inventory.CloudServiceType.stat
      - inventory.CloudService.get
      - inventory.CloudService.list
      - inventory.CloudService.analyze
      - inventory.CloudService.stat
      - inventory.ResourceGroup.get
      - inventory.ResourceGroup.list
      - inventory.ResourceGroup.stat
      - inventory.Collector.get
      - inventory.Collector.list_schedules
      - inventory.Collector.get_schedule
      - inventory.Collector.list
      - inventory.Collector.stat
      - inventory.CollectorRule.get
      - inventory.CollectorRule.list
      - inventory.CollectorRule.stat
      - inventory.Job.list
      - inventory.Job.stat
      - inventory.JobTask.list
      - inventory.JobTask.stat
      - inventory.ChangeHistory.list
      - inventory.ChangeHistory.stat
      - inventory.Note.get
      - inventory.Note.list
      - inventory.Note.stat
      - monitoring.DataSource.get
      - monitoring.DataSource.list
      - monitoring.DataSource.stat
      - monitoring.Metric.*
      - monitoring.Log.*
      - monitoring.ProjectAlertConfig.get
      - monitoring.ProjectAlertConfig.list
      - monitoring.ProjectAlertConfig.stat
      - monitoring.EscalationPolicy.get
      - monitoring.EscalationPolicy.list
      - monitoring.EscalationPolicy.stat
      - monitoring.EventRule.get
      - monitoring.EventRule.list
      - monitoring.EventRule.stat
      - monitoring.Webhook.get
      - monitoring.Webhook.list
      - monitoring.Webhook.stat
      - monitoring.MaintenanceWindow.get
      - monitoring.MaintenanceWindow.list
      - monitoring.MaintenanceWindow.stat
      - monitoring.Alert.get
      - monitoring.Alert.list
      - monitoring.Alert.stat
      - monitoring.Event.get
      - monitoring.Event.list
      - monitoring.Event.stat
      - monitoring.Note.get
      - monitoring.Note.list
      - monitoring.Note.stat
      - monitoring.AlertLog.get
      - monitoring.AlertLog.list
      - monitoring.AlertLog.stat
      - monitoring.Job.get
      - monitoring.Job.list
      - monitoring.Job.stat
      - statistics.Resource.stat
      - statistics.Storage.get
      - statistics.Storage.list
      - statistics.Storage.stat
      - statistics.Schedule.get
      - statistics.Schedule.list
      - statistics.Schedule.stat
      - statistics.History.list
      - statistics.History.stat
      - billing.Billing.get_data
      - config.UserConfig.*
      - config.DomainConfig.get
      - config.DomainConfig.list
      - config.DomainConfig.stat
      - notification.Protocol.get
      - notification.Protocol.list
      - notification.Protocol.stat
      - notification.ProjectChannel.get
      - notification.ProjectChannel.list
      - notification.ProjectChannel.stat
      - notification.UserChannel.*
      - notification.Notification.delete
      - notification.Notification.set_read
      - notification.Notification.get
      - notification.Notification.list
      - notification.Notification.stat
      - cost_analysis.DataSource.get
      - cost_analysis.DataSource.list
      - cost_analysis.DataSource.stat
      - cost_analysis.Schedule.get
      - cost_analysis.Schedule.list
      - cost_analysis.Schedule.stat
      - cost_analysis.ExchangeRate.get
      - cost_analysis.ExchangeRate.list
      - cost_analysis.Cost.get
      - cost_analysis.Cost.list
      - cost_analysis.Cost.analyze
      - cost_analysis.Cost.analyze_v2
      - cost_analysis.Cost.stat
      - cost_analysis.DataSourceRule.get
      - cost_analysis.DataSourceRule.list
      - cost_analysis.DataSourceRule.stat
      - cost_analysis.Budget.get
      - cost_analysis.Budget.list
      - cost_analysis.Budget.stat
      - cost_analysis.BudgetUsage.list
      - cost_analysis.BudgetUsage.analyze
      - cost_analysis.BudgetUsage.stat
      - cost_analysis.Dashboard.get
      - cost_analysis.Dashboard.list
      - cost_analysis.CostQuerySet.*
      - cost_analysis.Job.get
      - cost_analysis.Job.list
      - cost_analysis.Job.stat
      - cost_analysis.JobTask.get
      - cost_analysis.JobTask.list
      - cost_analysis.JobTask.stat
      - cost_analysis.PublicDashboard.get
      - cost_analysis.PublicDashboard.list
      - cost_analysis.PublicDashboard.stat
      - cost_analysis.UserDashboard.*
      - cost_analysis.CustomWidget.*
      - board.Board.get
      - board.Board.list
      - board.Board.stat
      - board.Post.get
      - board.Post.list
      - board.Post.stat
      - file_manager.File.get_download_url
      - file_manager.File.get
      - file_manager.File.list
      - file_manager.File.stat
      - dashboard.DomainDashboard.*
      - dashboard.ProjectDashboard.*
      - dashboard.CustomWidget.*

tasks:
- name: Create Policy - ${{ item.policy_id }}
  id: policy
  uses: "@modules/resource"
  loop: ${{ var.policy|to_data }}
  spec:
    resource_type: repository.Policy
    data: 
      policy_id: ${{ item.policy_id }}
      name: ${{ item.name }}
      permissions: ${{ item.permissions|to_data }}
      domain_id: ${{ tasks.user_domain.output.domain_id }}
    mode: EXEC
    verb:
      exec: create
